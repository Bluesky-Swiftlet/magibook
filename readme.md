# Magibook

## What's this

便利な機能を提供する魔法の本を作れるようにするデータパックです．  
ただし現状はテレポートポイントの設置・消去とそれに対するテレポート機能しか実装してません．  
~~というかそもそも本来それを目的で作ったのに拡張性を考慮し始めるの謎~~

## How to install

一般的なデータパックの入れ方と同じです．

### ワールド生成時に追加

- 新規ワールドの設定入力画面で，[Data Packs]→[Open Pack Folder]押下で開いたフォルダにzipファイルを置く．
- Availableにmagibook.zipが追加されるのでSelectedに移動
- [Done]で戻って生成！

### 既存ワールドに追加

- 任意のワールドを選択
- [Edit]を押下
- 開く設定画面の[Open World Folder]を押下
- 開いたフォルダ内にあるdatapacks以下にmagibook.zipを追加
- [Save]を押下してワールドに入る
  - 多分入れてワールドを読み込んだら自動で有効化されると思います……
  - 一応ゲーム内に入って`/reload`するといいかも

## How to make Magibook

**本，羽根，黒染料，エンダーアイ** をクラフトで[知識の本]というのが結果に表示されますが，そのままクラフトするとMagibookになります．  
不定形レシピかつ素材が4種類なので作業台じゃなくても作れます．素材の方はさておき．  
Magibookを開くと英語で何か書いてあります．……頑張って読んでください．  
という冗談はさておき，現状は以下の機能が使えます．

### Teleport

#### TL;DR

- **PUT TELEPORT POINT**でテレポート地点設置可能．
- Magibookをメインに持って，スニークしたまま不動で5秒間経つとテレポート．
  - テレポート地点が設置されていなければ当然テレポート不可能です．
  - 発動条件およびコストとしてLv10が必要です．
- **EMERGENCY TELEPORT**を押すと緊急テレポートが発動．
  - 発動条件としてLv20，コストとして**全Lv**が必要です．
  - テレポート後は全回復・ダメージ系デバフ消去します．
- **DELETE TELEPORT POINT**を押すとテレポート地点消去．

#### 各種解説

- 押すとコマンドが実行される行は太字・下線の非斜体で書いた行です．
- **PUT TELEPORT POINT**でテレポート地点を設定できます．
  - 各プレイヤーで1個のみ設置可能です．
  - 2個目を置こうとすると，その前に置いたものは破壊されます．
  - 内部仕様の関係で，頭の位置のブロックが空気ブロックでないと作成失敗します．
  - 作成されるとビーコンの見た目のテレポート地点が設置されます．下側に生成者の名前が表示されます．
- テレポート地点が設定されている場合，チャージすることで経験値10Lvを消費してその地点にテレポートします．
  - Lv10以上で**メインにMagibookを持っている状態で**スニークするとチャージを始めます．
  - チャージ中はスニーク状態，かつ不動である必要があります．
    - スニーク状態での移動・ジャンプ・被ダメージによりチャージは消失します（溜め直しになります）．
    - メインをMagibook以外に変更してもチャージが消失します．また，開始条件を満たさなくなります．
  - チャージ開始で視界が狭窄する暗闇状態が付与され，同様に開始直後とその後1秒間隔で心音が鳴ります．これがチャージ中の合図です．
  - 5回目の心音から更に1秒経過でテレポートします．
    - つまり5秒間のチャージが必要です．
  - テレポート後，スニークを解除するまで再度チャージが開始することはありません．
  - また，テレポート後も地点設定は解除されません．なので何度でも同じ地点にテレポートできます．
- **EMERGENCY TELEPORT**を押すことで緊急用の即時テレポートが可能です．
  - Lv20以上ないと発動できません．また，発動コストとして**全Lvを消費します**．
  - 発動後，設定したテレポート地点は消失します．再設定を忘れないようにしてください．
  - 緊急用ということで，発動後は再生Ⅴ，衝撃吸収Ⅴ，火炎耐性，耐性Ⅴ，満腹度全回復が付与されます．
    - 再生と耐性は5秒間です．耐性により被ダメは原則0となるのと，再生の効果により基本的に全回復します．
    - 衝撃吸収と火炎耐性は10秒間です．とはいえエンチャ金リンゴと比べておまけ程度なので，テレポート先は安全な地点に設定しておく方がいいです．
    - ついでに毒・ウィザー・空腹が付与されていた場合，それらを解除します．
  - テレポート地点設定は基本的に発動の制約がないため，レベルがあるなら地点設定→即時緊急テレポートで短時間の耐久ブーストが出来なくもないです．
    - とはいえLv20以上を消費する上に，攻撃力などのバフはないのでコスパがいいかは微妙．飽くまで死ぬよりマシ，くらいの機能として設計したつもりです．
- **DELETE TELEPORT POINT**を押すことで，設置中のテレポート地点を消去します．
  - 基本的に全ディメンジョンで機能する……はずです．設置者とテレポート地点のディメンジョンが違っていても問題ないはず．
  - 消去時は設置者に破壊音とパーティクルが発生します．

## Tips

- Teleport
  - テレポート地点はチャンクローダーとしての機能を果たします．
    - 分かりやすく言えばスポーンチャンクと同等の機能．プレイヤーが存在しない場合も，該当チャンクが読み込まれた状態になります．
    - プレイヤーにつき1個のみなのでそこまで重くならないと思います……
  - 個人の識別はスコアボードのidentificationスコアを利用しています．
    - IDが振り分けられてないプレイヤーに振り分けるためのIDは，#ID_Holderが保持しています．
    - また，振り分け済みかどうかはプレイヤータグのidentificatedで判断しています．
      - そんな単語ないぞ！ってなるかもしれませんがご容赦ください．パッと見分かりやすいの……
    - そのため`tag <target> remove identificated`でIDの再振り分けが行われます．
    - また，`scoreboard players set <target> identificated <value>`で直接IDを弄ることもできます．
      - ……が，タグついた状態でこれやるとテレポート地点の設置が複数可能になってしまいバグるので，原則やらないでください．
      - 防ぐ処理もやろうと思えばできますが，基本的にコマンド使わないと出来ない操作なので重くしてまですることじゃないかなと……

## 予定

- Teleport
  - 通常テレポート後，30秒間テレポート元の位置に戻ることが出来るようにする．
    - その際は再度Lvを消費しないように設計する予定です．
    - 資材不足やアイテム整理など，行き来するよりは生成負荷などが減らせるかなと思ったための予定です．
    - タイマー自体はforceloadとアイテムのデスポーン組み合わせればいけそうです．
      - 通常デスポーンの5分猶予でないのは，短くしないと乱用されそうだなと思ったためです．
      - コストを考えれば不要かもしれませんが……

# Rights
このデータパックはChuzume氏作の[Momentum_Hookshot](https://github.com/Chuzume/Momentum-Hookshot)から，クラフトの実装を参考にして作成しております．  
当該データパックはクリエイティブ・コモンズのCC-BY-SA-4.0ライセンスに則って公開されており，そのため当データパックにもそのライセンスが継承されます．  
当データパックを更に改変して公開する場合，継承元であるChuzume氏および当該データパックの表示，および同ライセンスの継承適用が必須となります．
